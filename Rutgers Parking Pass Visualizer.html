<!DOCTYPE html>
<html>
  <head>
    <title>Rutgers Parking Pass Visualizer</title>
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.9.1/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.9.1/mapbox-gl.css' rel='stylesheet' />
    <style>
      body { margin: 0; padding: 0; }
      #map { position: absolute; top: 0; bottom: 0; width: 100%; z-index: -1; }
      #passChooser{position: fixed; top: 0; bottom: 0; width: 250px; z-index:1; opacity: 1; height: 210px; background:rgba(255, 255, 255, 0.75)}
      #campusChooser{position: fixed; top: 235px; bottom: 0; width: 250px; z-index:1; opacity: 1; height: 110px; background:rgba(255, 255, 255, 0.75);}
      #timeChooser{position: fixed; top: 370px; bottom: 0; width: 250px; z-index:1; opacity: 1; height: 130px; background:rgba(255, 255, 255, 0.75);}
      #timeChooserComm{position: fixed; top: 370px; bottom: 0; width: 250px; z-index:1; opacity: 1; height: 170px; background:rgba(255, 255, 255, 0.75);}
      #passForm{display: block}
      #campusForm{display: none}
      #timeForm{display: none}
      #timeFormComm{display: none}
    </style>
  </head>
  <body>
    <div id = "fieldBackground">

    </div>
    <form id="passForm">
    <fieldset id="passChooser">
      <legend>Select Your Parking Pass</legend>
      <div>
        <input type="radio" id="buschres" name="pass" value="buschres"/>
        <label for="buschres">Busch Resident</label>
      </div>
      <div>
        <input type="radio" id="cookres" name="pass" value="cookres" />
        <label for="cookres">Cook Resident</label>
      </div>
      <div>
        <input type="radio" id="dougres" name="pass" value="dougres"/>
        <label for="dougres">Douglass Resident</label>
      </div>
      <div>
        <input type="radio" id="livires" name="pass" value="livires"/>
        <label for="livires">Livingston Resident</label>
      </div>
      <hr class="dotted">
      <div>
        <input type="radio" id="buschcomm" name="pass" value="buschcomm"/>
        <label for="buschcomm">Busch Commuter</label>
      </div>
      <div>
        <input type="radio" id="cacomm" name="pass" value="cacomm"/>
        <label for="cacomm">College Ave Commuter</label>
      </div>
      <div>
        <input type="radio" id="cookcomm" name="pass" value="cookcomm"/>
        <label for="cookcomm">Cook Commuter</label>
      </div>
      <div>
        <input type="radio" id="dougcomm" name="pass" value="dougcomm"/>
        <label for="dougcomm">Douglass Commuter</label>
      </div>
      <div>
        <input type="radio" id="livicomm" name="pass" value="livicomm"/>
        <label for="livicomm">Livingston Commuter</label>
      </div>
    </fieldset>
  </form>
    <script>
    var activePass = null;
    var respasschecked = false;
    var commpasschecked = false;
    var passChooser = document.getElementById('passChooser');  
    passChooser.addEventListener('change', function(){
      
      //clear any existing layers
      if(map.getLayer('buschresident')){
        map.removeLayer('buschresident');
      }
      if(map.getLayer('cookresident')){
        map.removeLayer('cookresident');
      }
      if(map.getLayer('dougresident')){
        map.removeLayer('dougresident');
      }
      if(map.getLayer('liviresident')){
        map.removeLayer('liviresident');
      } 
      if(map.getLayer('buschcommuter')){
        map.removeLayer('buschcommuter');
      }
      if(map.getLayer('cacommuter')){
        map.removeLayer('cacommuter');
      }
      if(map.getLayer('cookcommuter')){
        map.removeLayer('cookcommuter');
      }
      if(map.getLayer('dougcommuter')){
        map.removeLayer('dougcommuter');
      }
      if(map.getLayer('livicommuter')){
        map.removeLayer('livicommuter');
      }
      
      //pass checkboxes
      var buschrescheckbox = document.getElementById('buschres');
      var cookrescheckbox = document.getElementById('cookres');
      var livirescheckbox = document.getElementById('livires');
      var dougrescheckbox = document.getElementById('dougres');
      respasschecked = buschrescheckbox.checked || cookrescheckbox.checked || dougrescheckbox.checked || livirescheckbox.checked;
      
      var buschcommcheckbox = document.getElementById('buschcomm');
      var cacommcheckbox = document.getElementById('cacomm');
      var cookcommcheckbox = document.getElementById('cookcomm');
      var livicommcheckbox = document.getElementById('livicomm');
      var dougcommcheckbox = document.getElementById('dougcomm');
      commpasschecked = buschcommcheckbox.checked || cacommcheckbox.checked || cookcommcheckbox.checked || dougcommcheckbox.checked || livicommcheckbox.checked;

      //display campus and time chooser depending on type of box clicked
      if(respasschecked){
        document.getElementById('campusForm').style.display = 'block';
        document.getElementById('timeFormComm').style.display = 'none';
        document.getElementById('timeForm').style.display = 'block';
        document.getElementById('timeChooserComm').style.zIndex = 1;
        document.getElementById('timeChooser').style.display = 2;
      }

      if(commpasschecked){
        document.getElementById('campusForm').style.display = 'block';
        document.getElementById('timeForm').style.display = 'none';
        document.getElementById('timeFormComm').style.display = 'block';
        document.getElementById('timeChooser').style.zIndex = 1;
        document.getElementById('timeChooserComm').style.display = 2;
      }

      //if statements loading in layers depending on selected pass
      if(buschrescheckbox.checked){
        activePass = 'buschresident';
        map.addLayer({
          'id': 'buschresident',
          'type': 'fill',
          'source': 'buschresident',
          'paint': {
          'fill-color': '#FF5733',
          'fill-opacity': 0.4
          },
          'layout': {
            'visibility': 'visible'
          },
          'filter': ['==', '$type', 'Polygon']
          });
      } else if(cookrescheckbox.checked){
        activePass = 'cookresident';
        map.addLayer({
          'id': 'cookresident',
          'type': 'fill',
          'source': 'cookresident',
          'paint': {
          'fill-color': '#FF5733',
          'fill-opacity': 0.4
          },
          'layout': {
            'visibility': 'visible'
          },
          'filter': ['==', '$type', 'Polygon']
          });
      } else if (dougrescheckbox.checked){
        activePass = 'dougresident';
        map.addLayer({
          'id': 'dougresident',
          'type': 'fill',
          'source': 'dougresident',
          'paint': {
          'fill-color': '#FF5733',
          'fill-opacity': 0.4
          },
          'layout': {
            'visibility': 'visible'
          },
          'filter': ['==', '$type', 'Polygon']
          });
      } else if (livirescheckbox.checked){
        activePass = 'liviresident';
        map.addLayer({
          'id': 'liviresident',
          'type': 'fill',
          'source': 'liviresident',
          'paint': {
          'fill-color': '#FF5733',
          'fill-opacity': 0.4
          },
          'layout': {
            'visibility': 'visible'
          },
          'filter': ['==', '$type', 'Polygon']
          });
      } else if(buschcommcheckbox.checked){
        activePass = 'buschcommuter';
        map.addLayer({
          'id': 'buschcommuter',
          'type': 'fill',
          'source': 'buschcommuter',
          'paint': {
          'fill-color': '#FF5733',
          'fill-opacity': 0.4
          },
          'layout': {
            'visibility': 'visible'
          },
          'filter': ['==', '$type', 'Polygon']
          });
      } else if(cacommcheckbox.checked){
        activePass = 'cacommuter';
        map.addLayer({
          'id': 'cacommuter',
          'type': 'fill',
          'source': 'cacommuter',
          'paint': {
          'fill-color': '#FF5733',
          'fill-opacity': 0.4
          },
          'layout': {
            'visibility': 'visible'
          },
          'filter': ['==', '$type', 'Polygon']
          });
      } else if(cookcommcheckbox.checked){
        activePass = 'cookcommuter';
        map.addLayer({
          'id': 'cookcommuter',
          'type': 'fill',
          'source': 'cookcommuter',
          'paint': {
          'fill-color': '#FF5733',
          'fill-opacity': 0.4
          },
          'layout': {
            'visibility': 'visible'
          },
          'filter': ['==', '$type', 'Polygon']
          });
      }else if(dougcommcheckbox.checked){
        activePass = 'dougcommuter';
        map.addLayer({
          'id': 'dougcommuter',
          'type': 'fill',
          'source': 'dougcommuter',
          'paint': {
          'fill-color': '#FF5733',
          'fill-opacity': 0.4
          },
          'layout': {
            'visibility': 'visible'
          },
          'filter': ['==', '$type', 'Polygon']
          });
      }else if(livicommcheckbox.checked){
        activePass = 'livicommuter';
        map.addLayer({
          'id': 'livicommuter',
          'type': 'fill',
          'source': 'livicommuter',
          'paint': {
          'fill-color': '#FF5733',
          'fill-opacity': 0.4
          },
          'layout': {
            'visibility': 'visible'
          },
          'filter': ['==', '$type', 'Polygon']
          });
      } else {}

      map.on('click', activePass, (e) => {
        new mapboxgl.Popup()
        .setLngLat(e.lngLat)
        .setHTML(e.features[0].properties.name)
        .addTo(map);
        });
        
        // Change the cursor to a pointer when
        // the mouse is over the states layer.
      map.on('mouseenter', activePass, () => {
      map.getCanvas().style.cursor = 'pointer';
      });
        
        // Change the cursor back to a pointer
        // when it leaves the states layer.
      map.on('mouseleave', activePass, () => {
      map.getCanvas().style.cursor = '';
      });
      
      if(respasschecked){
        loadFilters();
      }

      if(commpasschecked){
        loadFiltersComm();
      }
      
    });
    </script>
    <form id="campusForm">
    <fieldset id="campusChooser">
      <legend>Select Campus(es)</legend>
      <div>
        <input type="checkbox" id="busch" name="campus" value="busch"/>
        <label for="busch">Busch</label>
      </div>
      <div>
        <input type="checkbox" id="ca" name="campus" value="ca" />
        <label for="ca">College Ave</label>
      </div>
      <div>
        <input type="checkbox" id="cook" name="campus" value="cook" />
        <label for="cook">Cook</label>
      </div>
      <div>
        <input type="checkbox" id="doug" name="campus" value="doug" />
        <label for="doug">Douglass</label>
      </div>
      <div>
        <input type="checkbox" id="livi" name="campus" value="livi" />
        <label for="livi">Livingston</label>
      </div>
    </fieldset>
    </form>
    <script>
      var campusChooser = document.getElementById('campusChooser');
      
      function loadFilters(){
        //composite filters
        var overallfilter = false;
        var campusfilter = ['any'];
        var timefilter = ['any'];

        //campus filters
        var livifilter = [['==', 'livi', ['get', 'campus']]];
        var buschfilter = [['==', 'busch', ['get', 'campus']]];
        var cafilter = [['==', 'ca', ['get', 'campus']]];
        var cookfilter = [['==', 'cook', ['get', 'campus']]];
        var dougfilter = [['==', 'doug', ['get', 'campus']]];

        //time filters
        var alwaysfilter = [['==', 'true', ['get', 'always']]];
        var mf82filter = [['==', 'true', ['get', 'mf82']]];
        var mf88filter = [['==', 'true', ['get', 'mf88']]];
        var ss62filter = [['==', 'true', ['get', 'ss62']]];
        var f4m8filter = [['==', 'true', ['get', 'f4m8']]];

        //campus checkboxes
        var buschcheckbox = document.getElementById('busch');
        var cacheckbox = document.getElementById('ca');
        var cookcheckbox = document.getElementById('cook');
        var dougcheckbox = document.getElementById('doug');
        var livicheckbox = document.getElementById('livi');
        var campusChecked = buschcheckbox.checked || cacheckbox.checked || cookcheckbox.checked || dougcheckbox.checked || livicheckbox.checked;

        //time checkboxes
        var alwayscheckbox = document.getElementById('always');
        var mf82checkbox = document.getElementById('mf82');
        var mf88checkbox = document.getElementById('mf88');
        var ss62checkbox = document.getElementById('ss62');
        var f4m8checkbox = document.getElementById('f4m8');
        var anycheckbox = document.getElementById('any');
        var timeChecked = alwayscheckbox.checked || mf82checkbox.checked || mf88checkbox.checked || ss62checkbox.checked || f4m8checkbox.checked
       
        //list of if statements to check campus filters
        if(buschcheckbox.checked){
          campusfilter = campusfilter.concat(buschfilter);
        }
        if(cacheckbox.checked){
          campusfilter = campusfilter.concat(cafilter);
        }
        if(cookcheckbox.checked){
          campusfilter = campusfilter.concat(cookfilter);
        }
        if(dougcheckbox.checked){
          campusfilter = campusfilter.concat(dougfilter);
        }
        if(livicheckbox.checked){
          campusfilter = campusfilter.concat(livifilter);
        }

        //list of if statements to check time filters
        if(alwayscheckbox.checked){
          timefilter = timefilter.concat(alwaysfilter);
        } else if(mf82checkbox.checked){
          timefilter = timefilter.concat(mf82filter);
        } else if(mf88checkbox.checked){
          timefilter = timefilter.concat(mf88filter);
        } else if(ss62checkbox.checked){
          timefilter = timefilter.concat(ss62filter);
        } else if(f4m8checkbox.checked){
          timefilter = timefilter.concat(f4m8filter);
        };

        //statements to check whether campus or time is checked
        if(campusChecked && (!timeChecked || anycheckbox.checked)){
          overallfilter = campusfilter;
        }
        if(!campusChecked && (timeChecked)){
          overallfilter = timefilter;
        }
        if(campusChecked && timeChecked){
          overallfilter = ['all', campusfilter, timefilter];
        }
        if(!campusChecked && !timeChecked && !anycheckbox.checked){
          overallfilter = false;
        } 
        if(!campusChecked && !timeChecked && anycheckbox.checked){
          overallfilter = null;
        }

        //set filter on selected pass
        if(activePass == null){
        } else {
          map.setFilter(activePass, overallfilter);
        }
        
      };

      function loadFiltersComm(){

        var overallfilter = false;
        var campusfilter = ['any'];
        var timefilter = ['any'];

        //campus filters
        var livifilter = [['==', 'livi', ['get', 'campus']]];
        var buschfilter = [['==', 'busch', ['get', 'campus']]];
        var cafilter = [['==', 'ca', ['get', 'campus']]];
        var cookfilter = [['==', 'cook', ['get', 'campus']]];
        var dougfilter = [['==', 'doug', ['get', 'campus']]];

        //time filters
        var mf6a2afilter = [['==', 'true', ['get', 'mf6a2a']]];
        var mf6p2afilter = [['==', 'true', ['get', 'mf6p2a']]];
        var mf6p8afilter = [['==', 'true', ['get', 'mf6p8a']]];
        var ss6a2afilter = [['==', 'true', ['get', 'ss6a2a']]];
        var f6pm8afilter = [['==', 'true', ['get', 'f6pm8a']]];
        var mf8p2afilter = [['==', 'true', ['get', 'mf8p2a']]]; 
        var mf75p2afilter = [['==', 'true', ['get', 'mf75p2a']]]; 

        //campus checkboxes
        var buschcheckbox = document.getElementById('busch');
        var cacheckbox = document.getElementById('ca');
        var cookcheckbox = document.getElementById('cook');
        var dougcheckbox = document.getElementById('doug');
        var livicheckbox = document.getElementById('livi');
        var campusChecked = buschcheckbox.checked || cacheckbox.checked || cookcheckbox.checked || dougcheckbox.checked || livicheckbox.checked;

        //time checkboxes
        var mf6a2acheckbox = document.getElementById('mf6a2a');
        var mf6p2acheckbox = document.getElementById('mf6p2a');
        var mf6p8acheckbox = document.getElementById('mf6p8a');
        var ss6a2acheckbox = document.getElementById('ss6a2a');
        var f6pm8acheckbox = document.getElementById('f6pm8a');
        var mf8p2acheckbox = document.getElementById('mf8p2a');
        var mf75p2acheckbox = document.getElementById('mf75p2a');
        var anycommcheckbox = document.getElementById('anycomm');
        var timeCheckedComm = mf6a2acheckbox.checked || mf6p2acheckbox.checked || mf6p8acheckbox.checked || ss6a2acheckbox.checked || f6pm8acheckbox.checked || mf8p2acheckbox.checked || mf75p2acheckbox.checked;
       
        //list of if statements to check campus filters
        if(buschcheckbox.checked){
          campusfilter = campusfilter.concat(buschfilter);
        }
        if(cacheckbox.checked){
          campusfilter = campusfilter.concat(cafilter);
        }
        if(cookcheckbox.checked){
          campusfilter = campusfilter.concat(cookfilter);
        }
        if(dougcheckbox.checked){
          campusfilter = campusfilter.concat(dougfilter);
        }
        if(livicheckbox.checked){
          campusfilter = campusfilter.concat(livifilter);
        }

        //list of if statements to check time filters
        if(mf6a2acheckbox.checked){
          timefilter = timefilter.concat(mf6a2afilter);
        } else if (mf6p2acheckbox.checked) {
          timefilter = timefilter.concat(mf6p2afilter);
        } else if (mf6p8acheckbox.checked) {
          timefilter = timefilter.concat(mf6p8afilter);
        } else if (ss6a2acheckbox.checked) {
          timefilter = timefilter.concat(ss6a2afilter);
        } else if (f6pm8acheckbox.checked) {
          timefilter = timefilter.concat(f6pm8afilter);
        } else if (mf8p2acheckbox.checked) {
          timefilter = timefilter.concat(mf8p2afilter);
        } else if (mf75p2acheckbox.checked) {
          timefilter = timefilter.concat(mf75p2afilter);
        } 

        //statements to check whether campus or time is checked
        if(campusChecked && (!timeCheckedComm || anycommcheckbox.checked)){
          overallfilter = campusfilter;
        }
        if(!campusChecked && (timeCheckedComm)){
          overallfilter = timefilter;
        }
        if(campusChecked && timeCheckedComm){
          overallfilter = ['all', campusfilter, timefilter];
        }
        if(!campusChecked && !timeCheckedComm && !anycommcheckbox.checked){
          overallfilter = false;
        } 
        if(!campusChecked && !timeCheckedComm && anycommcheckbox.checked){
          overallfilter = null;
        }

        //set filter on selected pass
        if(activePass == null){
        } else {
          console.log(overallfilter);
          console.log(activePass);
          map.setFilter(activePass, overallfilter);
        }

      };

      campusChooser.addEventListener('change', function(){
        if (respasschecked){
           loadFilters();
        } else if(commpasschecked){
          loadFiltersComm();
        }
        });
    </script>
    <form id= "timeForm">
    <fieldset id="timeChooser">
      <legend>Select Time</legend>
      <div>
        <input type="radio" id="always" name="time" value="always" />
        <label for="always">24 hours, 7 days a week</label>
      </div>
      <div>
        <input type="radio" id="mf82" name="time" value="mf82" />
        <label for="mf82">Monday - Friday, 8PM - 2AM</label>
      </div>
      <div>
        <input type="radio" id="mf88" name="time" value="mf88" />
        <label for="mf88">Monday - Friday, 8PM - 8AM</label>
      </div>
      <div>
        <input type="radio" id="ss62" name="time" value="ss62" />
        <label for="ss62">Saturday & Sunday, 6AM - 2AM</label>
      </div>
      <div>
        <input type="radio" id="f4m8" name="time" value="f4m8" />
        <label for="f4m8">Friday, 4PM - Monday 8AM</label>
      </div>
      <div>
        <input type="radio" id="any" name="time" value="any" />
        <label for="any">Any of the Above</label>
      </div>
    </fieldset>
    </form>
    <script>
        var timeChooser = document.getElementById('timeChooser');
        timeChooser.addEventListener('change', function(){
        loadFilters();
        });
    </script>
    
    <form id = "timeFormComm">
    <fieldset id="timeChooserComm">
      <legend>Select Time</legend>
      <div>
        <input type="radio" id="mf6a2a" name="timeComm" value="mf6a2a" />
        <label for="mf6a2a">Monday - Friday, 6AM - 2AM</label>
      </div>
      <div>
        <input type="radio" id="mf6p2a" name="timeComm" value="mf6p2a" />
        <label for="mf6p2a">Monday - Friday, 6PM - 2AM</label>
      </div>
      <div>
        <input type="radio" id="mf6p8a" name="timeComm" value="mf6p8a" />
        <label for="mf6p8a">Monday - Friday, 6PM - 8AM</label>
      </div>
      <div>
        <input type="radio" id="ss6a2a" name="timeComm" value="ss6a2a" />
        <label for="ss6a2a">Saturday & Sunday, 6AM - 2AM</label>
      </div>
      <div>
        <input type="radio" id="f6pm8a" name="timeComm" value="f6pm8a" />
        <label for="f6pm8a">Friday, 6PM - Monday 8AM</label>
      </div>
      <div>
        <input type="radio" id="mf8p2a" name="timeComm" value="mf8p2a" />
        <label for="mf8p2a">Monday - Friday, 8PM - 2AM</label>
      </div>
      <div>
        <input type="radio" id="mf75p2a" name="timeComm" value="mf75p2a" />
        <label for="mf75p2a">Monday - Friday, 7:30PM - 2AM</label>
      </div>
      <div>
        <input type="radio" id="anycomm" name="timeComm" value="anycomm" />
        <label for="anycomm">Any of the Above</label>
      </div>
    </fieldset>
    </form>
    <script>
      var timeChooserComm = document.getElementById('timeChooserComm');
        timeChooserComm.addEventListener('change', function(){
        loadFiltersComm();
        });
    </script>


    <div id="map"></div>
    <script>
      mapboxgl.accessToken = 'pk.eyJ1IjoiaGFydjQycyIsImEiOiJjbGlhbzliNmEwNGxuM21wbWwweWIydmZrIn0.JSODcY08IjYtFfNA_V295w';
      // sets bounds to Rutgers Campuses
      const bounds = [
            [-74.49142474386696,40.54496830476808], // Northwest coordinate
            [-74.37692118570746,40.443946213361755]  // Southeast coordinate
          ];
      
      const map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/streets-v11',
        center: [-74.441099, 40.496577],
        zoom: 12,
      });

      //imports sources corresponding to the different parking passes
      map.on('load', () => {
        map.addSource('buschresident', {
        type: 'geojson',
        data: 'https://raw.githubusercontent.com/harv42s/rutgersparkinglots/main/buschresident.geojson'
        });

        map.addSource('cookresident', {
        type: 'geojson',
        // Use a URL for the value for the `data` property.
        data: 'https://raw.githubusercontent.com/harv42s/rutgersparkinglots/main/cookresident.geojson'
        });

        map.addSource('dougresident', {
                type: 'geojson',
                // Use a URL for the value for the `data` property.
                data: 'https://raw.githubusercontent.com/harv42s/rutgersparkinglots/main/dougresident.geojson'
        });

        map.addSource('liviresident', {
        type: 'geojson',
        // Use a URL for the value for the `data` property.
        data: 'https://raw.githubusercontent.com/harv42s/rutgersparkinglots/main/liviresident.geojson'
        });

        map.addSource('buschcommuter', {
        type: 'geojson',
        // Use a URL for the value for the `data` property.
        data: 'https://raw.githubusercontent.com/harv42s/rutgersparkinglots/main/buschcommuter.geojson'
        });
        
        map.addSource('cacommuter', {
        type: 'geojson',
        // Use a URL for the value for the `data` property.
        data: 'https://raw.githubusercontent.com/harv42s/rutgersparkinglots/main/cacommuter.geojson'
        });

        map.addSource('cookcommuter', {
        type: 'geojson',
        // Use a URL for the value for the `data` property.
        data: 'https://raw.githubusercontent.com/harv42s/rutgersparkinglots/main/cookcommuter.geojson'
        });

        map.addSource('dougcommuter', {
        type: 'geojson',
        // Use a URL for the value for the `data` property.
        data: 'https://raw.githubusercontent.com/harv42s/rutgersparkinglots/main/dougcommuter.geojson'
        });

        map.addSource('livicommuter', {
        type: 'geojson',
        // Use a URL for the value for the `data` property.
        data: 'https://raw.githubusercontent.com/harv42s/rutgersparkinglots/main/livicommuter.geojson'
        });

        

});
    </script>
  </body>
</html>